\begin{lstlisting}[caption=Perfect links, mathescape, captionpos=b]
upon event <Init> do delivered := $\empty$

upon event <pp2pDeliver | dst, m> do
trigger <sp2pSend dst, m>

upon event <sp2pDeliver | src, m> do
if m $\notin$ delivered then
delivered := delivered $\cup$ {m}
trigger <pp2pDeliver | src, m>
\end{lstlisting}
